<!DOCTYPE html>
<!-- "Il file static/index.html" - come da doc professore -->
<!-- Funziona anche SENZA controller (Spring serve static/index.html di default) -->
<!-- Con controller: aprire http://localhost:8085/index.html -->
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WEBGUI — Monitor Stiva</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&family=Barlow+Condensed:wght@300;400;600;700;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg:         #0a0c0f;
            --panel:      #0e1117;
            --border:     #1e2530;
            --accent:     #00e5ff;
            --warn:       #ffb300;
            --danger:     #ff1744;
            --ok:         #00e676;
            --muted:      #3a4455;
            --text:       #c8d6e5;
            --text-dim:   #5a6a7a;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            background: var(--bg);
            color: var(--text);
            font-family: 'Barlow Condensed', sans-serif;
            min-height: 100vh;
        }

        /* Scanlines */
        body::before {
            content: '';
            position: fixed; inset: 0;
            background: repeating-linear-gradient(0deg, transparent, transparent 2px,
                rgba(0,0,0,0.07) 2px, rgba(0,0,0,0.07) 4px);
            pointer-events: none; z-index: 999;
        }

        /* ── HEADER ── */
        header {
            display: flex; align-items: center; justify-content: space-between;
            padding: 16px 28px;
            background: var(--panel);
            border-bottom: 1px solid var(--border);
            position: relative;
        }
        header::after {
            content: ''; position: absolute; bottom: 0; left: 0; right: 0; height: 1px;
            background: linear-gradient(90deg, transparent, var(--accent), transparent);
            opacity: 0.5;
        }
        .logo-main { font-size: 26px; font-weight: 900; letter-spacing: 4px; color: #fff; }
        .logo-sub  { font-family: 'Share Tech Mono', monospace; font-size: 10px;
                     color: var(--accent); letter-spacing: 3px; display: block; margin-top: 2px; }

        .conn-status { display: flex; align-items: center; gap: 8px;
                       font-family: 'Share Tech Mono', monospace; font-size: 12px; }
        .conn-dot { width: 8px; height: 8px; border-radius: 50%; background: var(--muted); transition: all .3s; }
        .conn-dot.connected { background: var(--ok); box-shadow: 0 0 10px rgba(0,230,118,.5);
                              animation: pulse 2s infinite; }
        .conn-dot.error     { background: var(--danger); box-shadow: 0 0 10px rgba(255,23,68,.5); }
        @keyframes pulse { 0%,100%{opacity:1} 50%{opacity:.4} }

        /* ── ALARM BANNER ── */
        #alarm-banner {
            display: none; align-items: center; gap: 14px;
            padding: 12px 28px;
            background: rgba(255,23,68,.1);
            border-bottom: 1px solid var(--danger);
            animation: alarm-flash .8s infinite;
        }
        #alarm-banner.active { display: flex; }
        @keyframes alarm-flash { 50% { background: rgba(255,23,68,.22); } }
        .alarm-text { font-size: 16px; font-weight: 700; letter-spacing: 3px;
                      color: var(--danger); text-transform: uppercase; }

        /* ── MAIN LAYOUT ── */
        main {
            display: grid;
            grid-template-columns: 1fr 300px;
            gap: 18px;
            padding: 22px 28px;
            max-width: 1300px;
            margin: 0 auto;
        }

        /* ── SEZIONI ── */
        .panel {
            background: var(--panel);
            border: 1px solid var(--border);
            padding: 20px;
        }
        .section-label {
            font-family: 'Share Tech Mono', monospace;
            font-size: 10px; letter-spacing: 3px;
            color: var(--accent); margin-bottom: 16px;
            text-transform: uppercase;
        }

        /* ── SLOT CARDS ── */
        .hold-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 14px; }

        .slot-card {
            padding: 20px 16px 16px;
            border: 1px solid var(--border);
            background: #080b0f;
            transition: all .4s;
            position: relative; overflow: hidden;
        }
        .slot-card.occupied {
            border-color: var(--accent);
            box-shadow: 0 0 12px rgba(0,229,255,.35);
        }
        .slot-number { font-family: 'Share Tech Mono', monospace;
                       font-size: 11px; letter-spacing: 2px;
                       color: var(--text-dim); margin-bottom: 10px; }
        .slot-visual {
            display: flex; align-items: center; justify-content: center;
            height: 70px; margin-bottom: 14px;
        }
        .slot-box {
            width: 64px; height: 52px;
            border: 2px solid var(--muted);
            display: flex; align-items: center; justify-content: center;
            transition: all .4s; position: relative;
        }
        .slot-card.occupied .slot-box {
            border-color: var(--accent);
            background: rgba(0,229,255,.07);
        }
        .slot-cargo {
            width: 42px; height: 34px;
            border: 1px dashed var(--muted);
            opacity: 0; transition: all .4s;
        }
        .slot-card.occupied .slot-cargo {
            background: rgba(0,229,255,.2);
            border: 1px solid rgba(0,229,255,.6);
            opacity: 1;
        }
        .slot-status-label {
            text-align: center; font-size: 12px; font-weight: 700;
            letter-spacing: 3px; text-transform: uppercase;
            color: var(--text-dim); transition: color .3s;
        }
        .slot-card.occupied .slot-status-label { color: var(--accent); }

        /* ── SENSORI ── */
        .sensor-row {
            display: flex; align-items: center; justify-content: space-between;
            padding: 12px 0; border-bottom: 1px solid rgba(30,37,48,.8);
        }
        .sensor-row:last-child { border-bottom: none; }
        .sensor-name { font-size: 11px; font-weight: 600; letter-spacing: 2px;
                       text-transform: uppercase; color: var(--text-dim); }
        .sensor-value {
            font-family: 'Share Tech Mono', monospace; font-size: 12px;
            padding: 3px 10px; border: 1px solid currentColor; letter-spacing: 1px;
        }
        .sensor-value.ok    { color: var(--ok); }
        .sensor-value.warn  { color: var(--warn); }
        .sensor-value.error { color: var(--danger); animation: blink .8s infinite; }
        .sensor-value.off   { color: var(--text-dim); border-color: var(--muted); }
        @keyframes blink { 50%{opacity:.4} }

        /* ── STATS ── */
        .stat-item { padding: 12px 0; border-bottom: 1px solid rgba(30,37,48,.8); }
        .stat-item:last-child { border-bottom: none; }
        .stat-label { font-family: 'Share Tech Mono', monospace; font-size: 10px;
                      letter-spacing: 3px; color: var(--text-dim); text-transform: uppercase; }
        .stat-value { font-size: 28px; font-weight: 900; color: #fff; }
        .stat-bar { height: 3px; background: var(--muted); margin-top: 6px; }
        .stat-bar-fill { height: 100%; background: var(--accent);
                         box-shadow: 0 0 8px rgba(0,229,255,.4); transition: width .6s; }

        /* ── MESSAGGI (area output prof) ── */
        .full-row { grid-column: 1 / -1; }

        #messageArea {
            width: 100%; height: 120px;
            background: #050709; border: 1px solid var(--border);
            color: var(--ok); font-family: 'Share Tech Mono', monospace;
            font-size: 12px; padding: 10px; resize: none;
        }

        /* ── INPUT + SEND (come da template prof) ── */
        .input-row { display: flex; gap: 10px; margin-top: 10px; }
        #inputmessage {
            flex: 1; background: #050709; border: 1px solid var(--border);
            color: var(--text); font-family: 'Share Tech Mono', monospace;
            font-size: 13px; padding: 8px 12px;
        }
        #inputmessage:focus { outline: none; border-color: var(--accent); }
        #sendMessage {
            padding: 8px 20px; background: transparent;
            border: 1px solid var(--accent); color: var(--accent);
            font-family: 'Barlow Condensed', sans-serif;
            font-size: 13px; font-weight: 700; letter-spacing: 2px;
            cursor: pointer; text-transform: uppercase;
            transition: all .2s;
        }
        #sendMessage:hover { background: var(--accent); color: #000; }

        /* ── LOG ── */
        .log-list {
            font-family: 'Share Tech Mono', monospace; font-size: 11px;
            line-height: 1.7; max-height: 120px; overflow-y: auto;
        }
        .log-entry { display: flex; gap: 14px; padding: 1px 0;
                     border-bottom: 1px solid rgba(30,37,48,.4);
                     animation: log-in .3s ease-out; }
        @keyframes log-in { from{opacity:0;transform:translateX(-6px)} to{opacity:1;transform:none} }
        .log-time   { color: var(--text-dim); flex-shrink: 0; }
        .log-source { color: var(--accent); width: 40px; flex-shrink: 0; }
        .log-msg    { color: var(--text); }

        #clock { font-family: 'Share Tech Mono', monospace; font-size: 13px;
                 color: var(--text-dim); letter-spacing: 2px; }
    </style>
</head>
<body>

<!-- HEADER -->
<header>
    <div>
        <span class="logo-main">WEBGUI</span>
        <span class="logo-sub">SISTEMA DI MONITORAGGIO</span>
    </div>
    <div style="display:flex;align-items:center;gap:20px">
        <div class="conn-status">
            <div class="conn-dot" id="conn-dot"></div>
            <span id="conn-label">DISCONNESSO</span>
        </div>
        <div id="clock">--:--:--</div>
    </div>
</header>

<!-- ALARM BANNER -->
<div id="alarm-banner">
    <span style="font-size:20px">⚠</span>
    <span class="alarm-text">ALLARME — ROBOT FERMO</span>
</div>

<!-- MAIN -->
<main>

    <!-- MAPPA STIVA -->
    <div class="panel">
        <div class="section-label">▸ mappa stiva — 5 slot</div>
        <div class="hold-grid">
            <div class="slot-card" id="slot-1">
                <div class="slot-number">SLOT 01</div>
                <div class="slot-visual"><div class="slot-box"><div class="slot-cargo"></div></div></div>
                <div class="slot-status-label" id="slot-1-label">LIBERO</div>
            </div>
            <div class="slot-card" id="slot-2">
                <div class="slot-number">SLOT 02</div>
                <div class="slot-visual"><div class="slot-box"><div class="slot-cargo"></div></div></div>
                <div class="slot-status-label" id="slot-2-label">LIBERO</div>
            </div>
            <div class="slot-card" id="slot-3">
                <div class="slot-number">SLOT 03</div>
                <div class="slot-visual"><div class="slot-box"><div class="slot-cargo"></div></div></div>
                <div class="slot-status-label" id="slot-3-label">LIBERO</div>
            </div>
            <div class="slot-card" id="slot-4">
                <div class="slot-number">SLOT 04</div>
                <div class="slot-visual"><div class="slot-box"><div class="slot-cargo"></div></div></div>
                <div class="slot-status-label" id="slot-4-label">LIBERO</div>
            </div>
            <!-- SLOT 5: sempre occupato, non modificabile dal server -->
            <div class="slot-card occupied" id="slot-5" style="border-color:var(--warn);box-shadow:0 0 12px rgba(255,179,0,.35);">
                <div class="slot-number">SLOT 05</div>
                <div class="slot-visual">
                    <div class="slot-box" style="border-color:var(--warn);background:rgba(255,179,0,.07);">
                        <div class="slot-cargo" style="background:rgba(255,179,0,.2);border:1px solid rgba(255,179,0,.6);opacity:1;"></div>
                    </div>
                </div>
                <div class="slot-status-label" style="color:var(--warn)">OCCUPATO</div>
            </div>
        </div>
    </div>

    <!-- SIDEBAR -->
    <div style="display:flex;flex-direction:column;gap:14px">

        <!-- SENSORI -->
        <div class="panel">
            <div class="section-label">▸ sensori</div>
            <div class="sensor-row">
                <span class="sensor-name">SONAR</span>
                <span class="sensor-value ok" id="sensor-sonar">DFREE</span>
            </div>
            <div class="sensor-row">
                <span class="sensor-name">LED</span>
                <span class="sensor-value off" id="sensor-led">SPENTO</span>
            </div>
            <div class="sensor-row">
                <span class="sensor-name">ROBOT</span>
                <span class="sensor-value ok" id="sensor-robot">OPERATIVO</span>
            </div>
        </div>

        <!-- STATS -->
        <div class="panel">
            <div class="section-label">▸ stats</div>
            <div class="stat-item">
                <div class="stat-label">Slot occupati</div>
                <div class="stat-value" id="stat-occupied">1 / 5</div>
                <div class="stat-bar"><div class="stat-bar-fill" id="stat-bar" style="width:20%"></div></div>
            </div>
            <div class="stat-item">
                <div class="stat-label">Ultimo update</div>
                <div style="font-family:'Share Tech Mono',monospace;font-size:12px;color:var(--accent)" id="stat-update">—</div>
            </div>
        </div>
		<!-- PESO -->
		<div class="panel">
		    <div class="section-label">▸ carico</div>
		    <div class="stat-item">
		        <div class="stat-label">Peso corrente / Max</div>
		        <div class="stat-value" id="stat-weight">— / —</div>
		        <div class="stat-bar">
		            <div class="stat-bar-fill" id="weight-bar" style="width:0%;background:var(--ok)"></div>
		        </div>
		    </div>
		    <div class="stat-item">
		        <div class="stat-label">Max Load</div>
		        <div style="font-family:'Share Tech Mono',monospace;font-size:12px;color:var(--accent)" 
		             id="stat-maxload">NON COMUNICATO</div>
		    </div>
		</div>

    </div>

    <!-- OUTPUT AREA (come da template del professore) -->
    <div class="panel full-row">
        <div class="section-label">▸ area di output (WebSocket)</div>
        <!-- "area di output" come da doc prof -->
        <textarea id="messageArea" name="messageArea" rows="5" cols="60"
                  placeholder="Messaggi WebSocket dal server..."></textarea>
        <!-- "area di input" + pulsante Send come da doc prof -->
        <div class="input-row">
            <p style="font-size:12px;color:var(--text-dim);align-self:center">Invia messaggio:</p>
            <input id="inputmessage" placeholder="es: slot_changed(3,true)" />
            <button id="sendMessage">Send</button>
        </div>
    </div>

    <!-- LOG EVENTI -->
    <div class="panel full-row">
        <div class="section-label">▸ log eventi CoAP → WebSocket</div>
        <div class="log-list" id="log-list"></div>
    </div>

</main>

<!-- Clock -->
<script>
    setInterval(function() {
        document.getElementById('clock').textContent =
            new Date().toTimeString().slice(0,8);
    }, 1000);
</script>

<!-- Script WebSocket del professore -->
<script src="wsminimal.js"></script>

</body>
</html>